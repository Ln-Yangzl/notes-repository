## 交换和路由

### 路由

#### 路由决定方式

![image-20220109155453401](https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220109155453401.png)

#### 路由选择方式

- 逐跳路由（中间节点决定）
  - 每个节点仅知道路径上的下一跳节点。
- 源路由（源节点决定）
  - 发送者决定途中经过的节点，并将其记录在分组头部。
    - 第三方（如人工配置）获得网络的拓扑来决定路径。
    - 或者扩散等动态发现协议了解路径。
    - 分组头部长度限制了源路由的规模。
  - 途中节点根据源路由信息获得下一跳节点。
  - 源路由可用于数据报和虚电路网络等，适合流量工程。
    - 可能更安全，也更危险。

##### 扩散法

仅根据本地信息选择路由的最简单的动态路由，将收到的分组向除到来链路外的所有其他链路转发。

抑制重复分组：

- 站点计数器
  - 每到达一个节点减1，为0时丢弃。
  - 初值可设置为网络的直径。
- 记录分组扩散的路径
  - 分组头部给出目前经过的节点列表。
  - 分组头部包含源节点和顺序号，途中节点记录收到的分组的源节点和顺序号字段。
- 选择扩散
  - 总是选择可能向目的节点的方向。

##### 逆向学习法

每个分组中包含源节点和节点计数器。

接收到分组时了解到到源节点方向的路径花费，从而经过一段时间学习到最短路径。

### 网桥

透明网桥提供网段间的隔离功能，进行“过滤”和“转发”

- 网桥的不同端口属于不同的冲突域。
- 网桥基于扩散法和逆向学习来维护一个转发表，记录节点在哪个端口上
  - 基于收到分组的源地址了解到节点可通过该端口到达。
  - 如果收到分组目的节点在转发表中找不到，则进行扩散。
  - 如果目的节点所在的端口与到来端口相同，则不转发。
  - 否则转发到目的节点所在的端口上。

基本工作方式：

<img src="https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220109160941526.png" alt="image-20220109160941526" style="zoom:67%;" />

#### 生成树算法

**生成树由所有局域网和网桥以及所有根端口和选取端口组成。**

- 生成树的**根桥**为BID最小的网桥。
- 网桥到根桥具有最少路径花费的路径为**根路径**，其花费为根路径花费，该路径上的第一个跳段所使用的端口为**根端口**。（根桥没有根端口）
- 每个局域网上到根桥的根路径花费最少(最靠近根桥)的那个网桥为**选取桥**。
- 选取桥连接到该局域网上的端口为**选取端口**。

<img src="https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220109162337842.png" alt="image-20220109162337842" style="zoom: 67%;" />

## 网络层：IP

### IP分组格式

![image-20220110081725507](https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220110081725507.png)

头部长度IHL（4bit）：取值5-15，以32比特为单位，20~60字节（选项最多40字节）。

总长度（16bit）：最长65535字节（数据最长65515字节）。

### IP分段和重组

分组传输经过的物理网络都有MTU（帧携带的数据大小）。

- IP采用接收方重组的策略。
- IP分组头部与分段相关字段：
  - 标识（16bit）：标识原始分组。（加上IP源地址和目的地址唯一标识）
  - 分段偏移（13bit）：原始IP分组的哪个部分？以8字节为单位à前面的分段携带数据长度为8的倍数。（可标识16bits长度空间）
  - MF：是否最后一个分段。（可以开始重组）
  - DF：不允许分段。

![image-20220110082204763](https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220110082204763.png)

### IP地址

#### IP地址类

![image-20220110082704619](https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220110082704619.png)

支持组播：D类地址。

#### 特殊IP地址

<img src="https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220110082900009.png" alt="image-20220110082900009" style="zoom: 67%;" />

### IP子网

#### 子网掩码

A类地址的掩码为255.0.0.0→/8；

B类地址的掩码为255.255.0.0→/16；

C类地址的掩码为255.255.255.0→/24；

子网掩码并不以字节单位为边界。

### DHCP

<img src="https://ln-markdown-image-bucket.oss-cn-beijing.aliyuncs.com/img/image-20220110084917407.png" alt="image-20220110084917407" style="zoom:67%;" />

